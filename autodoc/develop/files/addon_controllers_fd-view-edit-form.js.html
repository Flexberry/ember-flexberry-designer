<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>addon/controllers/fd-view-edit-form.js - Flexberry Documentation</title>
    <link rel="stylesheet" href="">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="stylesheet" href="../assets/css/custom.css">
    <link rel="stylesheet" href="../assets/vendor/bootstrap/css/bootstrap.css">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
</head>
<body class="yui3-skin-sam">
<div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
        <h1 class="brand" style="padding: 10px 16px 10px; height: 20px; line-height: 20px; margin-left: 0;">
	    <img alt="Flexberry Documentation" src="../assets/css/logo.png" style="max-height: 65%;" title="Flexberry Documentation">
            Flexberry Documentation
        </h1>
	<div class="nav">
            <li class="divider-vertical"></li>
            <li>
                <p class="navbar-text">
                    API Docs for Version: <b>develop</b>
                </p>
            </li>
        </div>
        <form class="navbar-form pull-right" style="line-height: 40px; height: 40px;">
            <input style="margin-top: 0;" type="text" class="search-query" placeholder="Search for classes/modules..." data-obj='["classes/Components.Tab", "classes/Components.TabPane", "classes/components.UiTabMenu", "classes/FdAppStructTree", "classes/FdAttributesTree", "classes/FdCurrentProjectContextService", "classes/FdDraggableControlMixin", "classes/FdEditformControl", "classes/FdEditformControlComponent", "classes/FdEditformGroup", "classes/FdEditformRow", "classes/FdEditformRowComponent", "classes/FdEditformTab", "classes/FdEditformTabgroup", "classes/FdFileComponent", "classes/FdGroupeditComponent", "classes/FdLimitByStageMixin", "classes/FdListformColumn", "classes/FdLoadingForTransitionMixin", "classes/FdLookupComponent", "classes/FdObjectListViewComponent", "classes/FdObjectlistviewComponent", "classes/FdUmlAssociation", "classes/FdUmlClass", "classes/FdUmlComposition", "classes/FdUmlDiagramComponent", "classes/FdUmlElement", "classes/FdUmlGeneralization", "classes/FdUmlLink", "classes/FdUmlNote", "classes/FdUmlNoteConnector", "classes/FdUmlPrimitive", "classes/FdViewAttributesDetail", "classes/FdViewAttributesMaster", "classes/FdViewAttributesProperty", "classes/flexberry.uml.Association", "classes/flexberry.uml.BaseClass", "classes/flexberry.uml.Class", "classes/flexberry.uml.ClassCollapsed", "classes/flexberry.uml.Composition", "classes/flexberry.uml.Generalization", "classes/flexberry.uml.Note", "classes/flexberry.uml.NoteConnector", "classes/NewPlatformFlexberryFlexberryDesignerVisualEditControl", "classes/NewPlatformFlexberryFlexberryDesignerVisualEditForm", "modules/components", "modules/ember-flexberry-designer"]'>
        </form>
    </div>
</div>
<div class="container">
    <div class="row">
        <div class="span3">
	    <div>
	        <h3>APIs</h3>
	        <div id="sidebar">
	            <ul id="main-nav" class="nav nav-tabs" style="margin-bottom:0;">
	                <li class="active"><a href="#classes" data-toggle="tab">Classes</a></li>
	                <li><a href="#modules" data-toggle="tab">Modules</a></li>
	            </ul>
	    
	            <div id="api-tabview-filter">
	                <input type="search" placeholder="Type to filter APIs">
	            </div>
	    
	            <div class="tab-content" style="border: 1px solid #DDD; border-top:0;">
	                <div class="tab-pane active" id="classes">
	                    <ul id="api-classes" class="nav nav-list">
	                            <li><a href="../classes/Components.Tab.html">Components.Tab</a></li>
	                            <li><a href="../classes/Components.TabPane.html">Components.TabPane</a></li>
	                            <li><a href="../classes/components.UiTabMenu.html">components.UiTabMenu</a></li>
	                            <li><a href="../classes/FdAppStructTree.html">FdAppStructTree</a></li>
	                            <li><a href="../classes/FdAttributesTree.html">FdAttributesTree</a></li>
	                            <li><a href="../classes/FdCurrentProjectContextService.html">FdCurrentProjectContextService</a></li>
	                            <li><a href="../classes/FdDraggableControlMixin.html">FdDraggableControlMixin</a></li>
	                            <li><a href="../classes/FdEditformControl.html">FdEditformControl</a></li>
	                            <li><a href="../classes/FdEditformControlComponent.html">FdEditformControlComponent</a></li>
	                            <li><a href="../classes/FdEditformGroup.html">FdEditformGroup</a></li>
	                            <li><a href="../classes/FdEditformRow.html">FdEditformRow</a></li>
	                            <li><a href="../classes/FdEditformRowComponent.html">FdEditformRowComponent</a></li>
	                            <li><a href="../classes/FdEditformTab.html">FdEditformTab</a></li>
	                            <li><a href="../classes/FdEditformTabgroup.html">FdEditformTabgroup</a></li>
	                            <li><a href="../classes/FdFileComponent.html">FdFileComponent</a></li>
	                            <li><a href="../classes/FdGroupeditComponent.html">FdGroupeditComponent</a></li>
	                            <li><a href="../classes/FdLimitByStageMixin.html">FdLimitByStageMixin</a></li>
	                            <li><a href="../classes/FdListformColumn.html">FdListformColumn</a></li>
	                            <li><a href="../classes/FdLoadingForTransitionMixin.html">FdLoadingForTransitionMixin</a></li>
	                            <li><a href="../classes/FdLookupComponent.html">FdLookupComponent</a></li>
	                            <li><a href="../classes/FdObjectListViewComponent.html">FdObjectListViewComponent</a></li>
	                            <li><a href="../classes/FdObjectlistviewComponent.html">FdObjectlistviewComponent</a></li>
	                            <li><a href="../classes/FdUmlAssociation.html">FdUmlAssociation</a></li>
	                            <li><a href="../classes/FdUmlClass.html">FdUmlClass</a></li>
	                            <li><a href="../classes/FdUmlComposition.html">FdUmlComposition</a></li>
	                            <li><a href="../classes/FdUmlDiagramComponent.html">FdUmlDiagramComponent</a></li>
	                            <li><a href="../classes/FdUmlElement.html">FdUmlElement</a></li>
	                            <li><a href="../classes/FdUmlGeneralization.html">FdUmlGeneralization</a></li>
	                            <li><a href="../classes/FdUmlLink.html">FdUmlLink</a></li>
	                            <li><a href="../classes/FdUmlNote.html">FdUmlNote</a></li>
	                            <li><a href="../classes/FdUmlNoteConnector.html">FdUmlNoteConnector</a></li>
	                            <li><a href="../classes/FdUmlPrimitive.html">FdUmlPrimitive</a></li>
	                            <li><a href="../classes/FdViewAttributesDetail.html">FdViewAttributesDetail</a></li>
	                            <li><a href="../classes/FdViewAttributesMaster.html">FdViewAttributesMaster</a></li>
	                            <li><a href="../classes/FdViewAttributesProperty.html">FdViewAttributesProperty</a></li>
	                            <li><a href="../classes/flexberry.uml.Association.html">flexberry.uml.Association</a></li>
	                            <li><a href="../classes/flexberry.uml.BaseClass.html">flexberry.uml.BaseClass</a></li>
	                            <li><a href="../classes/flexberry.uml.Class.html">flexberry.uml.Class</a></li>
	                            <li><a href="../classes/flexberry.uml.ClassCollapsed.html">flexberry.uml.ClassCollapsed</a></li>
	                            <li><a href="../classes/flexberry.uml.Composition.html">flexberry.uml.Composition</a></li>
	                            <li><a href="../classes/flexberry.uml.Generalization.html">flexberry.uml.Generalization</a></li>
	                            <li><a href="../classes/flexberry.uml.Note.html">flexberry.uml.Note</a></li>
	                            <li><a href="../classes/flexberry.uml.NoteConnector.html">flexberry.uml.NoteConnector</a></li>
	                            <li><a href="../classes/NewPlatformFlexberryFlexberryDesignerVisualEditControl.html">NewPlatformFlexberryFlexberryDesignerVisualEditControl</a></li>
	                            <li><a href="../classes/NewPlatformFlexberryFlexberryDesignerVisualEditForm.html">NewPlatformFlexberryFlexberryDesignerVisualEditForm</a></li>
	                    </ul>
	                </div>
	    
	                <div class="tab-pane" id="modules">
	                    <ul id="api-modules" class="nav nav-list">
	                            <li><a href="../modules/components.html">components</a></li>
	                            <li><a href="../modules/ember-flexberry-designer.html">ember-flexberry-designer</a></li>
	                    </ul>
	                </div>
	            </div>
	        </div>
	    </div>
        </div>
        <div class="span9">
                <form id="options-form" class="form-inline pull-right">
                    Show:
                    <label for="api-show-inherited" class="checkbox">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected" class="checkbox">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private" class="checkbox">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated" class="checkbox">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </form>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<div class="page-header">
    <h1>addon/controllers/fd-view-edit-form.js <small>File</small></h1>
</div>

<div class="file">
    <pre class="prettyprint linenums">
import Ember from &#x27;ember&#x27;;
import EditFormController from &#x27;ember-flexberry/controllers/edit-form&#x27;;
import FdViewAttributesProperty from &#x27;../objects/fd-view-attributes-property&#x27;;
import FdViewAttributesMaster from &#x27;../objects/fd-view-attributes-master&#x27;;
import FdViewAttributesDetail from &#x27;../objects/fd-view-attributes-detail&#x27;;
import { getDataForBuildTree, getClassTreeNode, getAssociationTreeNode } from &#x27;../utils/fd-attributes-for-tree&#x27;;
import { translationMacro as t } from &#x27;ember-i18n&#x27;;
import FdWorkPanelToggler from &#x27;../mixins/fd-work-panel-toggler&#x27;;
import { createPropertyName, restorationNodeTree, afterCloseNodeTree } from &#x27;../utils/fd-metods-for-tree&#x27;;

export default EditFormController.extend(FdWorkPanelToggler, {
  parentRoute: &#x27;fd-view-list-form&#x27;,

  /**
   Service that triggers objectlistview events.

   @property objectlistviewEventsService
   @type {Class}
   @default Ember.inject.service()
   */
  objectlistviewEventsService: Ember.inject.service(&#x27;objectlistview-events&#x27;),

  allAttrsHidedn: false,

  popupMessage: t(&#x60;forms.fd-view-edit-form.attributes-panel.close-panel-btn-caption&#x60;),

  /**
    Index of the selected attribute for editing.

    @property selectedRowIndex
    @type Number
    @default null
   */
  selectedRowIndex: null,

  /**
    Array of possible view name for selected detail for editing.

    @property detailViewNameItems
    @type Array
    @default []
   */
  detailViewNameItems: [],

  /**
    Type of the selected master for editing.

    @property lookupTypeItems
    @type Array
    @default [&#x27;default&#x27;, &#x27;standard&#x27;, &#x27;combo&#x27;]
   */
  lookupTypeItems: [&#x27;default&#x27;, &#x27;standard&#x27;, &#x27;combo&#x27;],

  /**
    Included plugins for jsTree.

    @property plugins
    @type String
    @default &#x27;wholerow, types, search&#x27;
   */
  plugins: &#x27;wholerow, types, search&#x27;,

  /**
    Selected nodes in jsTree.

    @property jstreeSelectedNodes
    @type Array
    @default []
   */
  jstreeSelectedNodes: Ember.A(),

  /**
    Type settings for jsTree.

    @property typesOptions
    @type Object
  */
  typesOptions: Ember.computed(() =&gt; ({
    &#x27;property&#x27;: {
      icon: &#x27;assets/images/attribute.bmp&#x27;
    },
    &#x27;master&#x27;: {
      icon: &#x27;assets/images/master.bmp&#x27;
    },
    &#x27;detail&#x27;: {
      icon: &#x27;assets/images/datail.png&#x27;
    },
    &#x27;class&#x27;: {
      icon: &#x27;assets/images/class.bmp&#x27;
    }
  })),

  /**
    Data for search tree nodes.

    @property searchTerm
    @type String
    @default &#x27;&#x27;
   */
  searchTerm: &#x27;&#x27;,

  /**
    Search settings for jsTree.

    @property searchOptions
    @type Object
  */
  searchOptions: Ember.computed(() =&gt; ({
    show_only_matches: true
  })),

  /**
    Type selected attribute for editing.

    @property propertyType
    @type Object
  */
  propertyType: Ember.computed(&#x27;rowModel&#x27;, function() {
    let rowModel = this.get(&#x27;rowModel&#x27;);
    if (rowModel instanceof FdViewAttributesDetail) {
      return &#x27;isDetail&#x27;;
    } else if (rowModel instanceof FdViewAttributesMaster) {
      return &#x27;isMaster&#x27;;
    } else {
      return null;
    }
  }),

  /**
    Data selected attribute for editing.

    @property rowModel
    @type Object
  */
  rowModel: Ember.computed(&#x27;selectedRowIndex&#x27;, function() {
    let model = this.get(&#x27;model.view.definition&#x27;);
    let index = this.get(&#x27;selectedRowIndex&#x27;);
    if (!Ember.isNone(index)) {
      let rowModel = model[index];
      let detailsViewArray = this.get(&#x27;model.detailsView&#x27;);
      let detailViewByName = detailsViewArray.findBy(&#x27;detailName&#x27;, rowModel.name);
      let detailViewByRole = detailsViewArray.findBy(&#x27;detailRole&#x27;, rowModel.name);
      if (detailViewByName) {
        this.set(&#x27;detailViewNameItems&#x27;, detailViewByName.detailViewNameItems);
      } else if (detailViewByRole) {
        this.set(&#x27;detailViewNameItems&#x27;, detailViewByRole.detailViewNameItems);
      } else {
        this.set(&#x27;detailViewNameItems&#x27;, []);
      }

      return rowModel;
    }

    return null;
  }),

  actions: {

    /**
      Resets &#x27;masterPropertyName&#x27; and &#x27;masterCustomizationString&#x27; if &#x27;LookupType&#x27; is &#x27;default&#x27;.

      @method actions.changeLookupType
      @param {Object} value An object with a new value in the &#x60;value&#x60; property.
    */
    changeLookupType(value) {
      if (value === &#x27;default&#x27;) {
        let rowModel = this.get(&#x27;rowModel&#x27;);
        rowModel.set(&#x27;masterPropertyName&#x27;, &#x27;&#x27;);
        rowModel.set(&#x27;masterCustomizationString&#x27;, &#x27;&#x27;);
      }
    },

    /**
      Handles form &#x27;onCreateCaptionClick&#x27; button click.

      @method actions.onCreateCaptionClick
    */
    onCreateCaptionClick() {
      let rowModel = this.get(&#x27;rowModel&#x27;);
      if (Ember.isNone(rowModel)) {
        return;
      }

      let splitName = rowModel.name.split(&#x27;.&#x27;);
      let caption = &#x27;&#x27;;
      splitName.forEach((partCaption) =&gt; {
        caption = partCaption + &#x27; &#x27; + caption;
      });

      Ember.set(rowModel, &#x27;caption&#x27;, caption.trim());
    },

    /**
      Handles form &#x27;onAttributesClick&#x27; table row click.

      @method actions.onAttributesClick
    */
    onAttributesClick(index) {
      let configPanelSidebar = Ember.$(&#x27;.ui.sidebar.config-panel&#x27;);
      let sidebarOpened = configPanelSidebar.hasClass(&#x27;visible&#x27;);
      let selectedRowIndex = this.get(&#x27;selectedRowIndex&#x27;);

      if ((!Ember.isNone(index) || sidebarOpened) &amp;&amp; selectedRowIndex !== index) {
        this.send(&#x27;toggleConfigPanel&#x27;, &#x27;active-tree-tab&#x27;, index);
      }

      this.set(&#x27;selectedRowIndex&#x27;, index);
    },

    /**
      Handles creating jsTree.

      @method actions.handleTreeDidBecomeReady
    */
    handleTreeDidBecomeReady() {
      let treeObject = this.get(&#x27;jstreeObject&#x27;);
      treeObject.on(&#x27;open_node.jstree&#x27;, this._openNodeTree.bind(this));
      treeObject.on(&#x27;after_close.jstree&#x27;, afterCloseNodeTree.bind(this));
    },

    /**
      Handles form &#x27;moveRightHighlighted&#x27; button click.
      Add attribute in definition.

      @method actions.moveRightHighlighted
    */
    moveRightHighlighted() {
      let selectedNodes = this.get(&#x27;jstreeSelectedNodes&#x27;)[0];
      let treeData = this.get(&#x27;model.tree&#x27;);
      let model = this.get(&#x27;model.view.definition&#x27;);

      // Create propertyName
      let propertyName = createPropertyName(selectedNodes, treeData[0], true);

      if (model.findBy(&#x27;name&#x27;, propertyName)) {
        return;
      }

      let newDdfinition;
      switch (selectedNodes.type) {
        case &#x27;property&#x27;:
          newDdfinition = FdViewAttributesProperty.create({
            name: propertyName
          });
          break;
        case &#x27;master&#x27;:
          newDdfinition = FdViewAttributesMaster.create({
            name: propertyName
          });
          break;
        case &#x27;detail&#x27;:
          newDdfinition = FdViewAttributesDetail.create({
            name: propertyName
          });
          break;
      }

      if (!Ember.isNone(newDdfinition)) {
        model.pushObject(newDdfinition);
      }
    },

    /**
      Handles form &#x27;moveLeftHighlighted&#x27; button click.
      Delete attribute from definition.

      @method actions.moveLeftHighlighted
    */
    moveLeftHighlighted() {
      let rowModel = this.get(&#x27;rowModel&#x27;);

      if (!Ember.isNone(rowModel)) {
        let model = this.get(&#x27;model.view.definition&#x27;);
        model.removeObject(rowModel);
        this.set(&#x27;selectedRowIndex&#x27;, null);
      }
    },

    /**
      Handles form &#x27;moveUpHighlighted&#x27; button click.

      @method actions.moveUpHighlighted
    */
    moveUpHighlighted() {
      let index = this.get(&#x27;selectedRowIndex&#x27;);
      if (index === 0) {
        return;
      }

      let prevAttrIndex = this.get(&#x27;prevAttr&#x27;);
      if (index === prevAttrIndex--) {
        this.set(&#x27;prevAttr&#x27;, prevAttrIndex);
      }

      let model = this.get(&#x27;model.view.definition&#x27;);
      let prev = index - 1;
      let node = model[index];
      let prevNode = model[prev];
      model.replace(prev, 1, node);
      model.replace(index, 1, prevNode);
      this.set(&#x27;selectedRowIndex&#x27;, prev);
    },

    /**
      Handles form &#x27;moveDownHighlighted&#x27; button click.

      @method actions.moveDownHighlighted
    */
    moveDownHighlighted() {
      let index = this.get(&#x27;selectedRowIndex&#x27;);
      let model = this.get(&#x27;model.view.definition&#x27;);
      if (index === model.length - 1) {
        return;
      }

      let prevAttrIndex = this.get(&#x27;prevAttr&#x27;);
      if (index === prevAttrIndex++) {
        this.set(&#x27;prevAttr&#x27;, prevAttrIndex);
      }

      let next = index + 1;
      let node = model[next];
      let nextNode = model[index];
      model.replace(index, 1, node);
      model.replace(next, 1, nextNode);
      this.set(&#x27;selectedRowIndex&#x27;, next);
    },

    closeRightpanel() {
      Ember.$(&#x27;.closable.panel-left&#x27;).toggle(500);

      if (this.allAttrsHidedn) {
        this.set(&#x27;popupMessage&#x27;, t(&#x27;forms.fd-view-edit-form.attributes-panel.close-panel-btn-caption&#x27;));
        Ember.$(&#x27;.panel-wrapper .panel-right.view-attributes&#x27;).css(&#x27;width&#x27;, &#x27;50%&#x27;);
      } else {
        this.set(&#x27;popupMessage&#x27;, t(&#x27;forms.fd-view-edit-form.attributes-panel.show-panel-btn-caption&#x27;));
        Ember.$(&#x27;.panel-wrapper .panel-right.view-attributes&#x27;).css(&#x27;width&#x27;, &#x27;100%&#x27;);
      }

      this.toggleProperty(&#x27;allAttrsHidedn&#x27;);
    },

    /**
      Handles form &#x27;saveView&#x27; button click.

      @method actions.saveView
    */
    saveView() {
      let view = this.get(&#x27;model.view&#x27;);
      view.set(&#x27;definition&#x27;, Ember.A(view.get(&#x27;definition&#x27;).toArray()));
      let _this = this;

      this.get(&#x27;objectlistviewEventsService&#x27;).setLoadingState(&#x27;loading&#x27;);
      view.save().then(() =&gt; {
        let routeName = _this.get(&#x27;routeName&#x27;);
        if (routeName.indexOf(&#x27;.new&#x27;) &gt; 0) {
          _this.transitionToRoute(routeName.slice(0, -4), view.get(&#x27;id&#x27;));
        } else {
          _this.get(&#x27;objectlistviewEventsService&#x27;).setLoadingState(&#x27;&#x27;);
        }
      });
    }
  },

  /**
    Overridden action for jsTree &#x27;openNode&#x27;.
    @method _openNodeTree
  */
  _openNodeTree(e, data) {
    let treeData = this.get(&#x27;model.tree&#x27;);
    restorationNodeTree(treeData, data.node.original, Ember.A([&#x27;master&#x27;, &#x27;class&#x27;]), false, (function(node) {
      let dataForBuildTree = getDataForBuildTree(this.get(&#x27;store&#x27;), node.get(&#x27;idNode&#x27;));
      let childrenAttributes = getClassTreeNode(Ember.A(), dataForBuildTree.classes);
      let childrenNode = getAssociationTreeNode(childrenAttributes, dataForBuildTree.associations, node.get(&#x27;id&#x27;));

      return childrenNode;
    }).bind(this));

    this.get(&#x27;jstreeActionReceiver&#x27;).send(&#x27;redraw&#x27;);
  },

  willDestroy() {
    this._super(...arguments);
    let treeObject = this.get(&#x27;jstreeObject&#x27;);
    if (!Ember.isNone(treeObject)) {
      treeObject.off(&#x27;open_node.jstree&#x27;, this._openNodeTree.bind(this));
      treeObject.off(&#x27;after_close.jstree&#x27;, afterCloseNodeTree.bind(this));
    }
  }
});

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/jquery/jquery-1.8.2.min.js"></script>
<script src="../assets/vendor/bootstrap/js/bootstrap.js"></script>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script src="../assets/js/yuidoc-bootstrap.js"></script>
<script>prettyPrint();</script>
</body>
</html>
