<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>addon/controllers/fd-appstruct-form.js - Flexberry Documentation</title>
    <link rel="stylesheet" href="">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="stylesheet" href="../assets/css/custom.css">
    <link rel="stylesheet" href="../assets/vendor/bootstrap/css/bootstrap.css">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
</head>
<body class="yui3-skin-sam">
<div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
        <h1 class="brand" style="padding: 10px 16px 10px; height: 20px; line-height: 20px; margin-left: 0;">
	    <img alt="Flexberry Documentation" src="../assets/css/logo.png" style="max-height: 65%;" title="Flexberry Documentation">
            Flexberry Documentation
        </h1>
	<div class="nav">
            <li class="divider-vertical"></li>
            <li>
                <p class="navbar-text">
                    API Docs for Version: <b>develop</b>
                </p>
            </li>
        </div>
        <form class="navbar-form pull-right" style="line-height: 40px; height: 40px;">
            <input style="margin-top: 0;" type="text" class="search-query" placeholder="Search for classes/modules..." data-obj='["classes/FdCurrentProjectContextService", "classes/FdEditformControl", "classes/FdEditformControlComponent", "classes/FdEditformGroup", "classes/FdEditformRow", "classes/FdEditformRowComponent", "classes/FdEditformTab", "classes/FdEditformTabgroup", "classes/FdLimitByStageMixin", "classes/FdViewAttributesDetail", "classes/FdViewAttributesMaster", "classes/FdViewAttributesProperty", "classes/FdViewAttributesTree", "classes/NewPlatformFlexberryFlexberryDesignerVisualEditControl", "classes/NewPlatformFlexberryFlexberryDesignerVisualEditForm", "modules/ember-flexberry-designer"]'>
        </form>
    </div>
</div>
<div class="container">
    <div class="row">
        <div class="span3">
	    <div>
	        <h3>APIs</h3>
	        <div id="sidebar">
	            <ul id="main-nav" class="nav nav-tabs" style="margin-bottom:0;">
	                <li class="active"><a href="#classes" data-toggle="tab">Classes</a></li>
	                <li><a href="#modules" data-toggle="tab">Modules</a></li>
	            </ul>
	    
	            <div id="api-tabview-filter">
	                <input type="search" placeholder="Type to filter APIs">
	            </div>
	    
	            <div class="tab-content" style="border: 1px solid #DDD; border-top:0;">
	                <div class="tab-pane active" id="classes">
	                    <ul id="api-classes" class="nav nav-list">
	                            <li><a href="../classes/FdCurrentProjectContextService.html">FdCurrentProjectContextService</a></li>
	                            <li><a href="../classes/FdEditformControl.html">FdEditformControl</a></li>
	                            <li><a href="../classes/FdEditformControlComponent.html">FdEditformControlComponent</a></li>
	                            <li><a href="../classes/FdEditformGroup.html">FdEditformGroup</a></li>
	                            <li><a href="../classes/FdEditformRow.html">FdEditformRow</a></li>
	                            <li><a href="../classes/FdEditformRowComponent.html">FdEditformRowComponent</a></li>
	                            <li><a href="../classes/FdEditformTab.html">FdEditformTab</a></li>
	                            <li><a href="../classes/FdEditformTabgroup.html">FdEditformTabgroup</a></li>
	                            <li><a href="../classes/FdLimitByStageMixin.html">FdLimitByStageMixin</a></li>
	                            <li><a href="../classes/FdViewAttributesDetail.html">FdViewAttributesDetail</a></li>
	                            <li><a href="../classes/FdViewAttributesMaster.html">FdViewAttributesMaster</a></li>
	                            <li><a href="../classes/FdViewAttributesProperty.html">FdViewAttributesProperty</a></li>
	                            <li><a href="../classes/FdViewAttributesTree.html">FdViewAttributesTree</a></li>
	                            <li><a href="../classes/NewPlatformFlexberryFlexberryDesignerVisualEditControl.html">NewPlatformFlexberryFlexberryDesignerVisualEditControl</a></li>
	                            <li><a href="../classes/NewPlatformFlexberryFlexberryDesignerVisualEditForm.html">NewPlatformFlexberryFlexberryDesignerVisualEditForm</a></li>
	                    </ul>
	                </div>
	    
	                <div class="tab-pane" id="modules">
	                    <ul id="api-modules" class="nav nav-list">
	                            <li><a href="../modules/ember-flexberry-designer.html">ember-flexberry-designer</a></li>
	                    </ul>
	                </div>
	            </div>
	        </div>
	    </div>
        </div>
        <div class="span9">
                <form id="options-form" class="form-inline pull-right">
                    Show:
                    <label for="api-show-inherited" class="checkbox">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected" class="checkbox">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private" class="checkbox">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated" class="checkbox">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </form>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<div class="page-header">
    <h1>addon/controllers/fd-appstruct-form.js <small>File</small></h1>
</div>

<div class="file">
    <pre class="prettyprint linenums">
import Ember from &#x27;ember&#x27;;
import TreeNodeObject from &#x27;ember-flexberry/objects/tree-node&#x27;;
import FdViewAttributesTree from &#x27;../objects/fd-view-attributes-tree&#x27;;
import { Query } from &#x27;ember-flexberry-data&#x27;;
import EditFormController from &#x27;ember-flexberry/controllers/edit-form&#x27;;

export default EditFormController.extend({

  currentProjectContext: Ember.inject.service(&#x27;fd-current-project-context&#x27;),

  removeLeftNodeDisabled: &#x27;disabled&#x27;,
  addLeftNodeDisabled: &#x27;disabled&#x27;,
  editLeftNodeDisabled: &#x27;disabled&#x27;,

  moveRightDisabled: &#x27;disabled&#x27;,

  addRightNodeDisabled: &#x27;disabled&#x27;,
  editRightNodeDisabled: &#x27;disabled&#x27;,
  removeRightNodeDisabled: &#x27;disabled&#x27;,
  addFolderNodeDisabled: &#x27;disabled&#x27;,
  upRightNodeDisabled: &#x27;disabled&#x27;,
  downRightNodeDisabled: &#x27;disabled&#x27;,

  jsonLeftTreeClass: &#x27;styled&#x27;,
  jsonRightTreeClass: &#x27;styled&#x27;,

  lastClicked: {
    left: {
      path: null,
      element: null
    },
    right: {
      path: null,
      element: null
    }
  },

  /**
    Data left jsTree.

    @property jsonLeftTreeNodes
    @type Array
    @default null
   */
  jsonLeftTreeNodes:null,

  /**
    Data right jsTree.

    @property jsonRightTreeNodes
    @type Array
    @default null
   */
  jsonRightTreeNodes: null,

  /**
    Included plugins for left jsTree.

    @property pluginsLeft
    @type String
    @default &#x27;wholerow, types, sort&#x27;
   */
  pluginsLeft: &#x27;wholerow, types, sort&#x27;,

  /**
    Included plugins for right jsTree.

    @property pluginsRight
    @type String
    @default &#x27;wholerow, types&#x27;
   */
  pluginsRight: &#x27;wholerow, types&#x27;,

  /**
    Selected nodes in left jsTree.

    @property jstreeSelectedNodesLeft
    @type Array
    @default []
   */
  jstreeSelectedNodesLeft: Ember.A(),

  /**
    Selected nodes in right jsTree.

    @property jstreeSelectedNodesRight
    @type Array
    @default []
   */
  jstreeSelectedNodesRight: Ember.A(),

  /**
    Type settings for jsTree.

    @property typesOptions
    @type Object
  */
  typesOptions: Ember.computed(() =&gt; ({
    &#x27;«listform»&#x27;: {
      icon: &#x27;assets/images/listform.png&#x27;
    },
    &#x27;«editform»&#x27;: {
      icon: &#x27;assets/images/editform.png&#x27;
    },
    &#x27;implementations&#x27;: {
      icon: &#x27;assets/images/implementations.png&#x27;
    },
    &#x27;desk&#x27;: {
      icon: &#x27;assets/images/class.bmp&#x27;
    },
    &#x27;notStored&#x27;: {
      icon: &#x27;assets/images/notStored.png&#x27;
    },
    &#x27;master&#x27;: {
      icon: &#x27;assets/images/master.bmp&#x27;
    },
    &#x27;property&#x27;: {
      icon: &#x27;assets/images/attribute.bmp&#x27;
    }
  })),

  _modelObserver: Ember.on(&#x27;init&#x27;, Ember.observer(&#x27;model&#x27;, function() {
    if (!this.get(&#x27;model&#x27;)) {
      return;
    }

    /*
      Create left tree.
    */

    // Model.form in tree data.
    let treeNodeForms = Ember.A();
    let forms = this.get(&#x27;model.forms&#x27;);
    forms.forEach((form, index) =&gt; {
      let idParent = form.get(&#x27;formViews&#x27;).mapBy(&#x27;view.class.id&#x27;);
      treeNodeForms.pushObject(
        FdViewAttributesTree.create({
          text: form.get(&#x27;caption&#x27;) || form.get(&#x27;name&#x27;),
          name: form.get(&#x27;name&#x27;),
          type: form.get(&#x27;stereotype&#x27;),
          id: &#x27;node_form_&#x27; + index,
          idNode: form.get(&#x27;id&#x27;),
          idParent: idParent[0],
          a_attr: {
            title: form.get(&#x27;stereotype&#x27;) + &#x27; &#x27; + form.get(&#x27;name&#x27;)
          }
        }));
    });

    // Model.implementations in tree data.
    let treeLeft = Ember.A();
    let implementations = this.get(&#x27;model.implementations&#x27;);
    implementations.forEach((implementation, index) =&gt; {
      let implementationsChildren = treeNodeForms.filterBy(&#x27;idParent&#x27;, implementation.id);
      let typeImplementation = implementation.get(&#x27;stored&#x27;) ? &#x27;implementations&#x27; : &#x27;notStored&#x27;;
      treeLeft.pushObject(
        FdViewAttributesTree.create({
          text: implementation.get(&#x27;caption&#x27;) || implementation.get(&#x27;name&#x27;),
          name: implementation.get(&#x27;name&#x27;),
          type: typeImplementation,
          id: &#x27;node_impl_&#x27; + index,
          idNode: implementation.get(&#x27;id&#x27;),
          children: implementationsChildren,
          copyChildren: implementationsChildren,
          a_attr: {
            title: implementation.get(&#x27;name&#x27;)
          }
        }));
    });

    Ember.set(this, &#x27;jsonLeftTreeNodes&#x27;, treeLeft);

    /*
      Create right tree.
    */

    let rightTreeNodes = Ember.A();
    let applications = this.get(&#x27;model.applications&#x27;);

    applications.forEach((application) =&gt; {
      rightTreeNodes.pushObject(application.get(&#x27;containersStr&#x27;)[0]);
    });

    let treeRight = FdViewAttributesTree.create({
      text: &#x27;Рабочий стол&#x27;,
      type: &#x27;desk&#x27;,
      id: &#x27;node_app&#x27;,
      children: rightTreeNodes,
      copyChildren: rightTreeNodes,
      state: {
        opened: true
      }
    });

    Ember.set(this, &#x27;jsonRightTreeNodes&#x27;, treeRight);
  })),

  /*jstreeSelectedNodesLeftObserver: Ember.observer(&#x27;jstreeSelectedNodesLeft&#x27;, function() {
    let jstreeSelectedNodesLeft = this.get(&#x27;jstreeSelectedNodesLeft&#x27;);
    if (jstreeSelectedNodesLeft.length === 0) {
      this.set(&#x27;removeLeftNodeDisabled&#x27;, &#x27;disabled&#x27;);
      this.set(&#x27;addLeftNodeDisabled&#x27;, &#x27;disabled&#x27;);
      this.set(&#x27;editLeftNodeDisabled&#x27;, &#x27;disabled&#x27;);
      this.set(&#x27;moveRightDisabled&#x27;, &#x27;disabled&#x27;);
    } else {
      this.set(&#x27;removeLeftNodeDisabled&#x27;, &#x27;&#x27;);
      this.set(&#x27;editLeftNodeDisabled&#x27;, &#x27;&#x27;);
      let selectedNode = jstreeSelectedNodesLeft[0];
      let typeNode = selectedNode.original.type;
      if (typeNode === &#x27;implementations&#x27;) {
        this.set(&#x27;addLeftNodeDisabled&#x27;, &#x27;&#x27;);
        this.set(&#x27;moveRightDisabled&#x27;, &#x27;disabled&#x27;);
      } else {
        this.set(&#x27;addLeftNodeDisabled&#x27;, &#x27;disabled&#x27;);
        this.set(&#x27;moveRightDisabled&#x27;, &#x27;&#x27;);
      }
    }
  }),*/

  _jsFlexberryTreeToTree: function (jsFlexberryTree) {
    if (!jsFlexberryTree) {
      return null;
    }

    let ret = [];
    for (let i = 0; i &lt; jsFlexberryTree.length; i++) {
      let node = jsFlexberryTree[i];
      let nodes = null;
      if (node.nodes) {
        nodes = this._jsFlexberryTreeToTree(node.nodes);
      }

      let treeNode = {
        id: node.id,
        caption: node.caption,
        description: node.description || &#x27;&#x27;,
        className: node.className,
        stereotype: node.stereotype,
      };
      if (nodes) {
        treeNode.nodes = nodes;
      }

      ret.push(treeNode);
    }

    return ret;
  },

  _findNodeByPath: function(jsonTree, path) {
    let ret = jsonTree;
    let steps = path ? path.split(&#x27;.&#x27;) : [];
    for (let i = 0; i &lt; steps.length; i++) {
      let step = steps[i];
      ret = ret[step];
    }

    return ret;
  },

  _findParentNodeByPath: function(jsonTree, path) {
    let steps = path.split(&#x27;.&#x27;);
    steps.pop();
    steps.pop();
    let parentPath = steps.join(&#x27;.&#x27;);
    let ret = this._findNodeByPath(jsonTree, parentPath);
    return ret;
  },

  _findParentNodesByPath: function(jsonTree, path) {
    let ret = jsonTree;
    let steps = path.split(&#x27;.&#x27;);
    let index = steps.pop();
    let nodesPath = steps.join(&#x27;.&#x27;);
    let parentNodes = this._findNodeByPath(jsonTree, nodesPath);
    ret = { parentNodes: parentNodes, index: parseInt(index) };
    return ret;
  },

  _setRightIconState: function(path) {
    let node = this._findNodeByPath(this, path);
    let { parentNodes, index } = this._findParentNodesByPath(this, path);
    let parentNodeChilds = parentNodes.length;
    Ember.set(this, &#x27;removeRightNodeDisabled&#x27;, path.split(&#x27;.&#x27;).length &gt; 2 ? &#x27;&#x27; : &#x27;disabled&#x27;);
    Ember.set(this, &#x27;editRightNodeDisabled&#x27;, &#x27;&#x27;);
    Ember.set(this, &#x27;addFolderNodeDisabled&#x27;, node.nodes ? &#x27;&#x27; : &#x27;disabled&#x27;);
    Ember.set(this, &#x27;upRightNodeDisabled&#x27;, index &gt; 0 ? &#x27;&#x27; : &#x27;disabled&#x27;);
    Ember.set(this, &#x27;downRightNodeDisabled&#x27;, index &lt; parentNodeChilds - 1 ? &#x27;&#x27; : &#x27;disabled&#x27;);
  },

  _setLeftIconState: function(/*path*/) {
    Ember.set(this, &#x27;removeLeftNodeDisabled&#x27;, &#x27;&#x27;);
    Ember.set(this, &#x27;addLeftNodeDisabled&#x27;, &#x27;&#x27;);
    Ember.set(this, &#x27;editLeftNodeDisabled&#x27;, &#x27;&#x27;);
    Ember.set(this, &#x27;moveRightDisabled&#x27;, &#x27;&#x27;);
    Ember.set(this, &#x27;addRightNodeDisabled&#x27;, &#x27;&#x27;);
  },

  _findPathOfNode(path, root, node) {
    if (node === root) {
      return path;
    }

    if (!root.nodes) {
      return false;
    }

    for (let i in root.nodes) {
      let subNode = root.nodes[i];
      let subPath = this._findPathOfNode(path + &#x27;.nodes.&#x27; + i.toString(), subNode, node);
      if (subPath !== false) {
        return subPath;
      }
    }

    return false;
  },

  _isLeaf: function(element) {
    let ret = element.children.length &gt; 0 &amp;&amp; element.children[0].style.visibility === &#x27;hidden&#x27;;
    return ret;
  },

  _getTopId: function(path) {
    if (typeof path !== &#x27;string&#x27;) {
      return;
    }

    let steps = path.split(&#x27;.&#x27;);
    if (steps.length &lt; 2) {
      return;
    }

    let node = this._findNodeByPath(this, steps.join(&#x27;.&#x27;));
    let ret = node.get(&#x27;id&#x27;);
    return ret;
  },

  actions: {

    /**
      Handles creating left jsTree.

      @method actions.handleLeftTreeDidBecomeReady
    */
    handleLeftTreeDidBecomeReady() {
      //let treeObject = this.get(&#x27;jstreeObjectLeft&#x27;);
      //treeObject.on(&#x27;open_node.jstree&#x27;, this._openNodeTree.bind(this));
    },

    /**
      Handles creating right jsTree.

      @method actions.handleRightTreeDidBecomeReady
    */
    handleRightTreeDidBecomeReady() {
      //let treeObject = this.get(&#x27;jstreeObjectRight&#x27;);
      //treeObject.on(&#x27;open_node.jstree&#x27;, this._openNodeTree.bind(this));
      //treeObject.on(&#x27;after_close.jstree&#x27;, this._afterCloseNodeTree.bind(this));
    },

    onTreenodeHeaderClick(...args) {
      let actionEventObject = args[args.length - 1];
      let clickedPath = args[0];
      /*let clickedNodeSettingsPrefix = Ember.$(actionEventObject.originalEvent.currentTarget)
        .closest(&#x27;.tab.segment&#x27;)
        .attr(&#x27;data-tab&#x27;);*/

      let lastClicked = null;
      let clickedElement = actionEventObject.originalEvent.target;
      if (clickedElement.tagName === &#x27;DIV&#x27;) {
        if (clickedPath.substr(0, 8) === &#x27;jsonLeft&#x27;) {
          if (!this._isLeaf(clickedElement)) {
            return;
          }

          lastClicked = this.lastClicked.left;
          this._setLeftIconState(/*clickedPath*/);
        } else if (clickedPath.substr(0, 9) === &#x27;jsonRight&#x27;) {
          lastClicked = this.lastClicked.right;
          this._setRightIconState(clickedPath);
        }

        if (lastClicked) {
          if (lastClicked.element) {
            lastClicked.element.style.backgroundColor = &#x27;&#x27;;
          }

          lastClicked.element = clickedElement;
          lastClicked.element.style.backgroundColor = &#x27;#cccccc&#x27;;
          lastClicked.path = clickedPath;
        }
      }

      if (clickedElement.tagName !== &#x27;I&#x27;) {
        args[1].originalEvent.stopPropagation();
      }
    },

    moveRightHighlighted() {
      let lastClickedPath = this.lastClicked.left.path;
      let node = this._findNodeByPath(this, lastClickedPath);
      let toPath = this.lastClicked.right.path ? this.lastClicked.right.path : &#x27;jsonRightTreeNodes.0&#x27;;
      let toNode = this._findNodeByPath(this, toPath);
      if (!toNode.nodes) {
        toNode = this._findParentNodeByPath(this, toPath);
      }

      toNode.nodes.pushObject(node);
    },

    removeLeftNode() {
    },

    addLeftClass() {
      let url = &#x27;/fd-class-edit-form/new&#x27;;
      this.transitionToRoute(url);
    },

    addLeftEditForm() {
      let classId = this._getTopId(this.lastClicked.left.path);
      if (classId) {
        let url = &#x27;/fd-editform-constructor/new?classId=&#x27; + classId;
        this.transitionToRoute(url);
      }

    },

    addLeftListForm() {
      let pathToObject = this.lastClicked.left.path.split(&#x27;.&#x27;, 2).join(&#x27;.&#x27;);
      let classId = this._getTopId(pathToObject);
      if (classId) {
        this.transitionToRoute(&#x27;fd-visual-listform&#x27;, {
          queryParams: {
            form: undefined,
            class: classId,
          },
        });
      }
    },

    editLeftNode() {
      let lastClickedPath = this.lastClicked.left.path;
      let node = this._findNodeByPath(this, lastClickedPath);
      let nodeId = node.get(&#x27;id&#x27;);
      let url;
      switch (node.get(&#x27;stereotype&#x27;)) {
        case &#x27;«listform»&#x27;:
          this.transitionToRoute(&#x27;fd-visual-listform&#x27;, {
            queryParams: {
              form: nodeId,
              class: undefined,
            },
          });
          break;
        case &#x27;«editform»&#x27;:
          url = &#x27;/fd-editform-constructor/&#x27; + nodeId;
          this.transitionToRoute(url);
          break;
        case &#x27;«implementation»&#x27;:
        case undefined:
          url = &#x27;fd-class-edit-form&#x27;;
          this.transitionToRoute(url, nodeId);
          break;
      }
    },

    listLeft() {
      this.transitionToRoute(&#x27;/fd-class-list-form&#x27;);
    },

    editRightNode() {
      let lastClickedPath = this.lastClicked.right.path;
      let lastClickedElement = this.lastClicked.right.element;
      let textElement = null;
      let caption = lastClickedElement.innerText.trim();
      for (let element = lastClickedElement.firstChild; element; element = element.nextSibling) {
        if (element.nodeType === 3 &amp;&amp; element.textContent.trim() === caption) {
          textElement = element;
          break;
        }
      }

      let inputElement = document.createElement(&#x27;input&#x27;);
      inputElement._this = this;
      inputElement.lastClickedPath = lastClickedPath;
      inputElement.setAttribute(&#x27;value&#x27;, caption);
      inputElement.style.display = &#x27;inline-block&#x27;;
      inputElement.style.position = &#x27;absolute&#x27;;
      inputElement.style.padding = &#x27;6px 0px 0px 2px&#x27;;
      inputElement.onkeypress = (event) =&gt; {
        if (event.keyCode === 13) {
          event.target.blur();
        }
      };

      inputElement.onblur = function (event) {
        let inputElement = event.target;
        let caption = inputElement.value;
        let textElement = document.createTextNode(caption);
        inputElement.parentNode.replaceChild(textElement, inputElement);
        let _this = inputElement._this;
        let node = _this._findNodeByPath(_this, inputElement.lastClickedPath);
        Ember.set(node, &#x27;caption&#x27;, caption);
      };

      textElement.parentNode.replaceChild(inputElement, textElement);
      inputElement.select();
      inputElement.focus();
    },

    removeRightNode() {
      let lastClickedPath = this.lastClicked.right.path;
      if (lastClickedPath.split(&#x27;.&#x27;).length &lt; 3) {
        return false;
      }

      let { parentNodes, index } = this._findParentNodesByPath(this, lastClickedPath);
      let removedNode = parentNodes[index];
      parentNodes.removeObject(removedNode);
    },

    addFolderNode() {
      let toPath = this.lastClicked.right.path ? this.lastClicked.right.path : &#x27;jsonRightTreeNodes.0&#x27;;
      let node = this._findNodeByPath(this, toPath);
      Ember.get(node, &#x27;nodes&#x27;).pushObject(TreeNodeObject.create({ caption: &#x27;New folder&#x27;, nodes: Ember.A() }));
    },

    upRightNode() {
      let lastClickedPath = this.lastClicked.right.path;
      let { parentNodes, index } = this._findParentNodesByPath(this, lastClickedPath);
      if (index === 0) {
        return false;
      }

      let prev = index - 1;
      let node = parentNodes[index];
      let prevNode = parentNodes[prev];

      parentNodes.arrayContentWillChange(prev, 0,  null);

      Ember.set(parentNodes, prev.toString(), node);
      Ember.set(parentNodes, index.toString(), prevNode);

      parentNodes.arrayContentDidChange(prev, null, null);

      let arrayClickedPath = lastClickedPath.split(&#x27;.&#x27;);
      arrayClickedPath[arrayClickedPath.length - 1] = prev.toString();
      let prevPath = arrayClickedPath.join(&#x27;.&#x27;);
      this._setRightIconState(prevPath);
      this.lastClicked.right.path = prevPath;
    },

    downRightNode() {
      let lastClickedPath = this.lastClicked.right.path;
      let { parentNodes, index } = this._findParentNodesByPath(this, lastClickedPath);
      if (index &gt;= parentNodes.length - 1) {
        return false;
      }

      let next = index + 1;
      let node = parentNodes[next];
      let nextNode = parentNodes[index];

      parentNodes.arrayContentWillChange(index, 0, null);

      Ember.set(parentNodes, index.toString(), node);
      Ember.set(parentNodes, next.toString(), nextNode);

      parentNodes.arrayContentDidChange(index, null, null);

      let arrayClickedPath = lastClickedPath.split(&#x27;.&#x27;);
      arrayClickedPath[arrayClickedPath.length - 1] = next.toString();
      let nextPath = arrayClickedPath.join(&#x27;.&#x27;);
      this._setRightIconState(nextPath);
      this.lastClicked.right.path = nextPath;
    },

    saveTree() {
      let rightTree = this._jsFlexberryTreeToTree(this.jsonRightTreeNodes[0].nodes);
      while (rightTree &amp;&amp; rightTree.length === 1 &amp;&amp; rightTree[0].caption === &#x27;Рабочий стол&#x27;) {
        rightTree = rightTree[0].nodes;
      }

      let builder = new Query.Builder(this.store)
      .from(&#x27;fd-dev-class&#x27;)
      .select(&#x27;name,stereotype,containersStr,caption,stage.id&#x27;)
      .byId(this.model.id);
      this.store.queryRecord(&#x27;fd-dev-class&#x27;, builder.build()).
      /*this.get(&#x27;store&#x27;).findRecord(&#x27;fd-dev-class&#x27;, this.model.id).*/
      then(function(record) {
        /*let stagePk = _this.get(&#x27;currentProjectContext&#x27;).getCurrentStagePk();*/
        record.set(&#x27;containersStr&#x27;, rightTree);
        /*record.set(&#x27;stage&#x27;, stagePk);*/
        record.save().then(
          function(data) {
            alert(&#x27;Success&#x27; + data);
          },
          function(data) {
            alert(&#x27;Error&#x27; + data);
          }
        );
      });
      /*alert(&#x27;Save&#x27;);*/
    },

    openProcessEditorForm() {

    },

    openGenerationForm() {

    }

  }

});

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/jquery/jquery-1.8.2.min.js"></script>
<script src="../assets/vendor/bootstrap/js/bootstrap.js"></script>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script src="../assets/js/yuidoc-bootstrap.js"></script>
<script>prettyPrint();</script>
</body>
</html>
